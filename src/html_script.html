</ul>
</div>
<hr>

<div class='pagination jsonly' onclick="request_reload()">RELOAD üßπ</div>
<noscript><a href="/?reload" class='pagination'>RELOAD üßπ</a></noscript>
<br>
<div class='pagination' onclick="Show_folder_maker()">Create Folder</div><br>

<br>
<hr><br>
<h2>Upload file</h2>
<form ENCTYPE="multipart/form-data" method="post" id="uploader">
	<input type="hidden" name="post-type" value="upload">
	<input type="hidden" name="post-uid" value="12345">

	<p>PassWord:&nbsp;&nbsp;</p><input name="password" type="text" label="Password"><br>
	<p>Load File:&nbsp;&nbsp;</p><input name="file" type="file" multiple /><br><br>

	<input type="submit" value="&#10174; upload" style="background-color: #555; height: 30px; width: 100px">
</form>

<br>
<p id="task"></p>
<p id="status"></p>
<hr>

<script>

const r_li = ${PY_LINK_LIST};
const f_li = ${PY_FILE_LIST};

document.getElementById("uploader").addEventListener('submit', e => {
	e.preventDefault()
	const formData = new FormData(e.target)
	const filenames = formData.getAll('files').map(v => v.name).join(', ')
	const request = new XMLHttpRequest()
	request.open(e.target.method, e.target.action)
	request.timeout = 3600000;
	request.onreadystatechange = () => {
		if (request.readyState === XMLHttpRequest.DONE) {
			let message = `${request.status}: ${request.statusText}`
			if (request.status === 204) message = 'Success'
			if (request.status === 0) message = 'Connection failed'
			document.getElementById('status').textContent = message
		}
	}
	request.upload.onprogress = e => {
		let message = e.loaded === e.total ? 'Saving...' : `${Math.floor(100*e.loaded/e.total)}%`
		document.getElementById("status").textContent = message
	}
	request.send(formData)
	document.getElementById('task').textContent = `Uploading :`
	document.getElementById('status').textContent = '0%'
})
const log = console.log,
	byId = document.getElementById.bind(document),
	byClass = document.getElementsByClassName.bind(document),
	byTag = document.getElementsByTagName.bind(document),
	byName = document.getElementsByName.bind(document),
	createElement = document.createElement.bind(document);
String.prototype.toHtmlEntities = function() {
	return this.replace(/./ugm, s => s.match(/[a-z0-9\s]+/i) ? s : "&#" + s.codePointAt(0) + ";");
};

function null_func() {
	return true
}

function toggle_scroll() {
	document.body.classList.toggle('overflowHidden');
}

function go_link(typee, locate) {
	// function to generate link for different types of actions
	return locate + "?" + typee;
}
// getting all the links in the directory
class Tools {
	// various tools for the page
	sleep(ms) {
		// sleeps for a given time in milliseconds
		return new Promise(resolve => setTimeout(resolve, ms));
	}
	onlyInt(str) {
		if (this.is_defined(str.replace)) {
			return parseInt(str.replace(/\D+/g, ""))
		}
		return 0;
	}
	del_child(elm) {
		if (typeof(elm) == "string") {
			elm = byId(elm)
		}
		while (elm.firstChild) {
			elm.removeChild(elm.lastChild);
		}
	}
	toggle_bool(bool) {
		return bool !== true;
	}
	exists(name) {
		return (typeof window[name] !== 'undefined')
	}
	hasClass(element, className, partial = false) {
		if (partial) {
			className = ' ' + className;
		} else {
			className = ' ' + className + ' ';
		}
		return (' ' + element.className + ' ').indexOf(className) > -1;
	}
	addClass(element, className) {
		if (!this.hasClass(element, className)) {
			element.classList.add(className);
		}
	}
	enable_debug() {
		if (!config.allow_Debugging) {
			alert("Debugging is not allowed");
			return;
		}
		if (config.Debugging) {
			return
		}
		config.Debugging = true;
		var script = createElement('script');
		script.src = "//cdn.jsdelivr.net/npm/eruda";
		document.body.appendChild(script);
		script.onload = function() {
			eruda.init()
		};
	}
	is_in(item, array) {
		return array.indexOf(item) > -1;
	}
	is_defined(obj) {
		return typeof(obj) !== "undefined"
	}
	toggle_scroll(allow = 2, by = "someone") {
		if (allow == 0) {
			document.body.classList.add('overflowHidden');
		} else if (allow == 1) {
			document.body.classList.remove('overflowHidden');
		} else {
			document.body.classList.toggle('overflowHidden');
		}
	}
	download(dataurl, filename = null) {
		const link = document.createElement("a");
		link.href = dataurl;
		link.download = filename;
		link.click();
	}
}
let tools = new Tools();
class Config {
	constructor() {
		this.total_popup = 0;
		this.popup_msg_open = false
	}
}
var config = new Config()
class Popup_Msg {
	constructor() {
		this.create()
		this.made_popup = false;
		this.init()
	}
	init() {
		this.onclose = null_func;
		this.scroll_disabled = false;
	}
	create() {
		var that = this;
		this.popup_id = config.total_popup;
		this.popup_obj = createElement("div")
		this.popup_obj.id = "popup-" + this.popup_id;
		this.popup_obj.classList.add("popup")
		this.popup_bg = createElement("div")
		this.popup_bg.classList.add("modal_bg")
		this.popup_bg.id = "popup-bg-" + this.popup_id;
		this.popup_bg.style.backgroundColor = "#000000EE";
		this.popup_bg.onclick = function() {
			that.close()
		}
		this.popup_obj.appendChild(this.popup_bg);
		var popup_box = createElement("div");
		popup_box.classList.add("popup-box")
		var close_btn = createElement("div");
		close_btn.classList.add("popup-close-btn")
		close_btn.onclick = function() {
			that.close()
		}
		close_btn.innerHTML = "&times;";
		popup_box.appendChild(close_btn)
		this.header = createElement("h1")
		this.header.id = "popup-header-" + this.popup_id;
		popup_box.appendChild(this.header)
		this.hr = createElement("popup-hr-" + this.popup_id);
		this.hr.style.width = "95%"
		popup_box.appendChild(this.hr)
		this.content = createElement("div")
		this.content.id = "popup-content-" + this.popup_id;
		popup_box.appendChild(this.content)
		this.popup_obj.appendChild(popup_box)
		byId("popup-container").appendChild(this.popup_obj)
		config.total_popup += 1;
	}
	close() {
		this.onclose()
		this.dismiss()
		config.popup_msg_open = false;
	}
	hide() {
		this.popup_obj.classList.remove("active");
		tools.toggle_scroll(1)
	}
	dismiss() {
		this.hide()
		tools.del_child(this.header);
		tools.del_child(this.content);
		this.made_popup = false;
	}
	async togglePopup(toggle_scroll = true) {
		if (!this.made_popup) {
			return
		}
		this.popup_obj.classList.toggle("active");
		if (toggle_scroll) {
			tools.toggle_scroll();
		}
		log(tools.hasClass(this.popup_obj, "active"))
		if (!tools.hasClass(this.popup_obj, "active")) {
			this.close()
		}
	}
	async open_popup(allow_scroll = false) {
		if (!this.made_popup) {
			return
		}
		this.popup_obj.classList.add("active");
		if (!allow_scroll) {
			tools.toggle_scroll(0);
			this.scroll_disabled = true;
		}
	}
	async createPopup(header = "", content = "", hr = true) {
		this.init()
		this.made_popup = true;
		if (typeof header === 'string' || header instanceof String) {
			this.header.innerHTML = header;
		} else if (header instanceof Element) {
			this.header.appendChild(header)
		}
		if (typeof content === 'string' || content instanceof String) {
			this.content.innerHTML = content;
		} else if (content instanceof Element) {
			this.content.appendChild(content)
		}
		if (hr) {
			this.hr.style.display = "block";
		} else {
			this.hr.style.display = "none";
		}
	}
}
let popup_msg = new Popup_Msg();
class ContextMenu {
	constructor() {
		this.old_name = null;
	}
	async on_result(self) {
		var data = false;
		if (self.status == 200) {
			data = JSON.parse(self.responseText);
		}
		popup_msg.close()
		await tools.sleep(300)
		if (data) {
			popup_msg.createPopup(data[0], data[1]);
		} else {
			popup_msg.createPopup("Failed", "Server didn't respond<br>response: " + self.status);
		}
		popup_msg.open_popup()
	}
	menu_click(action, link, more_data = null) {
		var that = this
		var url = ".";
		var xhr = new XMLHttpRequest();
		xhr.open("POST", url);
		xhr.onreadystatechange = function() {
			if (this.readyState === 4) {
				that.on_result(this)
			}
		};
		var formData = new FormData();
		formData.append("post-type", action);
		formData.append("post-uid", 123456);
		formData.append("name", link);
		formData.append("data", more_data)
		xhr.send(formData);
	}
	rename_data() {
		var new_name = byId("rename").value;
		popup_msg.close()
		this.menu_click("rename", this.old_name, new_name)
		// popup_msg.createPopup("Done!", "New name: "+new_name)
		// popup_msg.open_popup()
	}
	rename(link, name) {
		popup_msg.close()
		popup_msg.createPopup("Rename",
			"Enter new name: <input id='rename' type='text'><br><br><div class='pagination center' onclick='context_menu.rename_data()'>Change!</div>"
			);
		popup_msg.open_popup()
		this.old_name = link;
		byId("rename").value = name;
		byId("rename").focus()
	}
	show_menus(file, name, type) {
		var that = this;
		var menu = createElement("div")
		if (type == "video") {
			var download = createElement("div")
			download.innerHTML = "‚¨áÔ∏è".toHtmlEntities() + " Download"
			download.classList.add("menu_options")
			download.onclick = function() {
				tools.download(file, name);
				popup_msg.close()
			}
			menu.appendChild(download)
			var copy_url = ""
		}
		if (type == "folder") {
			var dl_zip = createElement("div")
			dl_zip.innerHTML = "üóÉÔ∏è".toHtmlEntities() + " Download as Zip"
			dl_zip.classList.add("menu_options")
			dl_zip.onclick = function() {
				popup_msg.close()
				window.open(go_link('czip', file), '_blank');
				// czip = "Create Zip"
			}
			menu.appendChild(dl_zip)
		}
		var rename = createElement("div")
		rename.innerHTML = "‚úèÔ∏è".toHtmlEntities() + " Rename"
		rename.classList.add("menu_options")
		rename.onclick = function() {
			that.rename(file, name)
		}
		menu.appendChild(rename)
		var del = createElement("div")
		del.innerHTML = "üóëÔ∏è".toHtmlEntities() + " Delete"
		del.classList.add("menu_options")
		var xxx = 'F'
		if (type == "folder") {
			xxx = 'D'
		}
		del.onclick = function() {
			that.menu_click('del-f', file);
		};
		log(file, type)
		menu.appendChild(del)
		var del_P = createElement("div")
		del_P.innerHTML = "üî•".toHtmlEntities() + " Delete permanently"
		del_P.classList.add("menu_options")

		function r_u_sure() {
			popup_msg.close()
			var box = createElement("div")
			var msggg = createElement("p")
			msggg.innerHTML = "This can't be undone!!!"
			box.appendChild(msggg)
			var y_btn = createElement("div")
			y_btn.innerHTML = "Continue"
			y_btn.className = "pagination center"
			y_btn.onclick = function() {
				that.menu_click('del-p', file);
			};
			var n_btn = createElement("div")
			n_btn.innerHTML = "Cancel"
			n_btn.className = "pagination center"
			n_btn.onclick = popup_msg.close;
			box.appendChild(y_btn)
			box.appendChild(n_btn)
			popup_msg.createPopup("Are you sure?", box)
			popup_msg.open_popup()
		}
		del_P.onclick = r_u_sure
		menu.appendChild(del_P)
		var property = createElement("div")
		property.innerHTML = "‚ÑπÔ∏è".toHtmlEntities() + " Properties"
		property.classList.add("menu_options")
		property.onclick = function() {
			that.menu_click('info', file);
		};
		menu.appendChild(property)
		popup_msg.createPopup("Menu", menu)
		popup_msg.open_popup()
	}
	create_folder() {
		let folder_name = document.getElementById('folder-name').value;
		this.menu_click('new folder', folder_name)
	}
}
var context_menu = new ContextMenu()
//context_menu.show_menus("next", "video")
function Show_folder_maker() {
	popup_msg.createPopup("Create Folder",
		"Enter folder name: <input id='folder-name' type='text'><br><br><div class='pagination center' onclick='context_menu.create_folder()'>Create</div>"
		);
	popup_msg.togglePopup();
}

function show_response(url, add_reload_btn = true) {
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function() {
		if (xhr.readyState == XMLHttpRequest.DONE) {
			let msg = xhr.responseText;
			if (add_reload_btn) {
				msg = msg + "<br><br><div class='pagination' onclick='window.location.reload()'>RefreshüîÑÔ∏è</div>";
			}
			popup_msg.close()
			popup_msg.createPopup("Result", msg);
			popup_msg.open_popup();
		}
	}
	xhr.open('GET', url, true);
	xhr.send(null);
}

function reload() {
	show_response("?reload");
}

function run_recyle(url) {
	return function() {
		show_response(url);
	}
}
tools.del_child("linkss");
const folder_li = document.createElement('ul');
const file_li = document.createElement("ul")
for (let i = 0; i < r_li.length; i++) {
	// time to customize the links according to their formats
	var folder = false
	let type = null;
	let ele = document.createElement('li');
	let r = r_li[i];
	let r_ = r.slice(1);
	let name = f_li[i];
	let link = document.createElement('a');
	link.href = r_;
	link.classList.add('all_link');
	let l_box = document.createElement("div")
	l_box.classList.add("all_link_container")
	if (r.startsWith('d')) {
		// add DOWNLOAD FOLDER OPTION in it
		// TODO: add download folder option by zipping it
		// currently only shows folder size and its contents
		type = "folder"
		folder = true
		l_box.innerHTML = "üìÇ".toHtmlEntities();
		l_box.classList.add('link');
	}
	if (r.startsWith('v')) {
		// if its a video, add play button at the end
		// that will redirect to the video player
		// clicking main link will download the video instead
		type = 'video';
		l_box.innerHTML = 'üé•'.toHtmlEntities();
		link.href = go_link("vid", r_)
		l_box.classList.add('vid');
	}
	if (r.startsWith('i')) {
		type = 'image'
		l_box.innerHTML = 'üåâ'.toHtmlEntities();
		l_box.classList.add('file');
	}
	if (r.startsWith('f')) {
		type = 'file'
		l_box.innerHTML = 'üìÑ'.toHtmlEntities();
		l_box.classList.add('file');
	}
	if (r.startsWith('h')) {
		type = 'html'
		l_box.innerHTML = 'üîó'.toHtmlEntities();
		l_box.classList.add('html');
	}

	l_box.innerHTML += "&nbsp;" + name;



	link.appendChild(l_box)
	ele.appendChild(link);
	// recycling option for the files and folder
	// files and folders are handled differently
	var xxx = "F"
	if (r.startsWith('d')) {
		xxx = "D";
	}
	var context = createElement('span');
	context.className = "pagination context_menu"
	context.innerHTML = '<b>&nbsp;&hellip;&nbsp;</b>';
	context.style.marginLeft = '50px';
	context.onclick = function() {
		log(r_, 1);
		context_menu.show_menus(r_, name, type);
	}
	ele.insertAdjacentElement("beforeend", context);
	var hrr = createElement("hr")
	ele.insertAdjacentElement("beforeend", hrr);
	if (folder) {
		folder_li.appendChild(ele);
	} else {
		file_li.appendChild(ele)
	}
}
var dir_container = document.getElementById("content_list")
dir_container.appendChild(folder_li)
dir_container.appendChild(file_li)
var dir_tree = byId("dir-tree");
dir_tree.style.overflow = "auto";
dir_tree.style.whiteSpace = "nowrap";
dir_tree.scrollLeft = dir_tree.scrollWidth;


</script>

<p>v3</p>
</body>

</html>